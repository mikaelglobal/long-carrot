<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ============ ESSENTIAL META TAGS ============ -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- ============ PRIMARY SEO TAGS ============ -->
    <title>MUMU AI - Modular Unified Machine for Understanding | Advanced AI Research Assistant</title>
    <meta name="description" content="MUMU AI is a cutting-edge artificial intelligence research assistant designed for academic projects, featuring advanced NLP, multi-model support, and intelligent memory systems. Get accurate, citation-verified research support powered by state-of-the-art AI models.">
    <meta name="keywords" content="MUMU AI, AI research assistant, academic AI tool, artificial intelligence, machine learning assistant, research chatbot, AI for students, university AI tool, NLP research, citation verification, academic writing assistant, AI research helper">
    <meta name="author" content="MUMU AI Research Team">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="language" content="English">
    <meta name="revisit-after" content="7 days">
    <meta name="rating" content="general">
    
    <!-- ============ OPEN GRAPH / FACEBOOK ============ -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://mumuai.vercel.app/">
    <meta property="og:site_name" content="MUMU AI">
    <meta property="og:title" content="MUMU AI - Advanced AI Research Assistant for Academic Excellence">
    <meta property="og:description" content="Transform your research workflow with MUMU AI - a modular, intelligent assistant for university projects. Features advanced NLP, citation verification, and multi-model AI support.">
    <meta property="og:image" content="https://mumuai.vercel.app/static/images/MUMU_AI_0.png">
    <meta property="og:image:alt" content="MUMU AI Logo - Colorful brain design representing artificial intelligence">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:locale" content="en_US">
    
    <!-- ============ TWITTER CARD ============ -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://mumuai.vercel.app/">
    <meta name="twitter:title" content="MUMU AI - AI Research Assistant for Academic Projects">
    <meta name="twitter:description" content="Advanced AI-powered research assistant with citation verification, multi-model support, and intelligent memory. Perfect for students and researchers.">
    <meta name="twitter:image" content="https://mumuai.vercel.app/static/images/MUMU_AI_0.png">
    <meta name="twitter:image:alt" content="MUMU AI - Modular Unified Machine for Understanding">
    <meta name="twitter:creator" content="@MUMUAI">
    <meta name="twitter:site" content="@MUMUAI">
    
    <!-- ============ ADDITIONAL SEO META ============ -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    </head>
    <body>
        <div id="root"></div>

        <!-- React + Babel (no build required) -->
        <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
        <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

        <script type="text/babel" data-type="module" src="/static/app.jsx"></script>
    </body>
    </html>
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message {
            display: flex;
            gap: 12px;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 65%;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .message.user .message-content {
            align-items: flex-end;
        }

        .bubble {
            padding: 16px 20px;
            border-radius: 18px;
            word-wrap: break-word;
            line-height: 1.65;
            font-size: 15px;
            position: relative;
            transition: all 0.2s ease;
        }

        .bubble.user {
            background: var(--gradient-primary);
            color: white;
            border-radius: 20px 20px 4px 20px;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25);
        }

        .bubble.ai {
            background: var(--dark-secondary);
            color: var(--light-text);
            border: 1px solid var(--border-light);
            border-radius: 20px 20px 20px 4px;
            box-shadow: 0 2px 8px var(--shadow);
        }

        /* Thinking Animation */
        .bubble.thinking {
            display: flex;
            gap: 6px;
            padding: 20px;
            min-width: 80px;
            justify-content: center;
            background: var(--dark-secondary);
            border: 1px solid var(--border-light);
        }

        .thinking-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary);
            animation: thinking 1.4s ease-in-out infinite;
        }

        .thinking-dot:nth-child(1) { animation-delay: 0s; }
        .thinking-dot:nth-child(2) { animation-delay: 0.2s; }
        .thinking-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes thinking {
            0%, 60%, 100% {
                transform: scale(1);
                opacity: 0.6;
            }
            30% {
                transform: scale(1.3);
                opacity: 1;
            }
        }

        /* Message Actions */
        .message-actions {
            display: flex;
            align-items: center;
            gap: 6px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        .action-btn {
            background: var(--dark-secondary);
            border: 1px solid var(--border-light);
            color: var(--muted-text);
            width: 36px;
            height: 36px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            font-size: 16px;
            position: relative;
        }

        .action-btn:hover {
            background: var(--dark-tertiary);
            color: var(--accent-light);
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .action-btn.copied {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        /* Reactions */
        .reactions {
            display: flex;
            gap: 6px;
        }

        .reaction-btn {
            background: var(--dark-secondary);
            border: 1px solid var(--border-light);
            color: var(--muted-text);
            width: 36px;
            height: 36px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            font-size: 18px;
        }

        .reaction-btn:hover {
            background: var(--dark-tertiary);
            transform: translateY(-2px) scale(1.1);
        }

        .reaction-btn.active.thumbs-up {
            background: var(--success);
            color: white;
            border-color: var(--success);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.4);
        }

        .reaction-btn.active.thumbs-down {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.4);
        }

        /* Input Area */
        .input-area {
            padding: 24px 28px;
            border-top: 1px solid var(--border);
            background: var(--dark-bg-secondary);
        }

        .input-wrapper {
            display: flex;
            align-items: flex-end;
            gap: 12px;
            background: var(--dark-secondary);
            border: 2px solid var(--border-light);
            border-radius: 16px;
            padding: 14px 16px;
            transition: all 0.2s ease;
        }

        .input-wrapper:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px var(--glow);
            background: var(--dark-secondary);
        }

        #promptInput {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--light-text);
            font-size: 15px;
            line-height: 1.5;
            resize: none;
            outline: none;
            font-family: inherit;
            max-height: 120px;
            caret-color: var(--primary);
        }

        #promptInput::placeholder {
            color: var(--dim-text);
        }

        #promptInput:focus {
            caret-color: var(--primary);
        }

        #sendBtn {
            background: var(--primary);
            color: white;
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        #sendBtn:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }

        #sendBtn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .input-hint {
            font-size: 12px;
            color: var(--dim-text);
            margin-top: 8px;
            text-align: center;
        }

        /* ============ MEMORIES SIDEBAR ============ */
        .memories-panel {
            width: 360px;
            background: var(--dark-bg);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .memories-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
            background: var(--gradient-bg);
        }

        .memories-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--light-text);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .memories-subtitle {
            font-size: 13px;
            color: var(--muted-text);
            line-height: 1.5;
        }

        .memories-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            padding: 16px 24px;
            border-bottom: 1px solid var(--border);
        }

        .stat-card {
            background: var(--dark-secondary);
            padding: 12px;
            border-radius: 10px;
            border: 1px solid var(--border-light);
        }

        .stat-value {
            font-size: 24px;
            font-weight: 800;
            color: var(--primary-light);
            display: block;
        }

        .stat-label {
            font-size: 11px;
            color: var(--muted-text);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 4px;
        }

        .memories-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .memories-content::-webkit-scrollbar {
            width: 8px;
        }

        .memories-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .memories-content::-webkit-scrollbar-thumb {
            background: var(--dark-tertiary);
            border-radius: 4px;
        }

        .memory-item {
            background: var(--dark-secondary);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .memory-item:hover {
            background: var(--dark-tertiary);
            border-color: var(--primary);
            transform: translateX(-4px);
        }

        .memory-item-timestamp {
            font-size: 11px;
            color: var(--dim-text);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .memory-item-text {
            font-size: 13px;
            color: var(--light-text);
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .memory-item-text strong {
            color: var(--primary-light);
            font-weight: 600;
        }

        .memory-item-meta {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .memory-badge {
            font-size: 11px;
            padding: 4px 8px;
            background: var(--dark-bg);
            border-radius: 6px;
            color: var(--muted-text);
            border: 1px solid var(--border);
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 48px 24px;
            text-align: center;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state-text {
            color: var(--muted-text);
            font-size: 14px;
            line-height: 1.6;
        }

        /* ============ RESPONSIVE DESIGN ============ */
        @media (max-width: 1200px) {
            .model-selector {
                display: none; /* Hide button selector on medium screens */
            }
        }

        @media (max-width: 1024px) {
            .memories-panel {
                width: 300px;
            }
            
            .message-content {
                max-width: 75%;
            }
            
            .model-info-badge {
                display: none; /* Hide badge on smaller screens */
            }
        }

        @media (max-width: 768px) {
            .memories-panel {
                display: none;
            }
            
            .message-content {
                max-width: 85%;
            }
            
            .header {
                padding: 16px 20px;
            }
            
            .logo-text {
                font-size: 24px;
            }
            
            .logo-image {
                width: 40px;
                height: 40px;
            }
            
            .header-title {
                font-size: 16px;
            }
            
            .header-subtitle {
                font-size: 10px;
            }
            
            .model-toggle-container {
                gap: 8px;
            }
            
            .toggle-label {
                font-size: 10px;
            }
            
            .quick-prompts {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .header-content {
                flex-wrap: wrap;
                gap: 12px;
            }
            
            .logo-container {
                gap: 8px;
            }
            
            .model-toggle-container {
                width: 100%;
                justify-content: center;
            }
        }

        /* ============ ANIMATIONS & EFFECTS ============ */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .generating {
            animation: pulse 2s ease-in-out infinite;
        }

        /* ============ ACCESSIBILITY ============ */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* Focus styles for keyboard navigation */
        *:focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- ============ MAIN CHAT SECTION ============ -->
        <div class="chat-section">
            <!-- Header -->
            <div class="header">
                <div class="header-content">
                    <div class="logo-container">
                        <img src="static/images/MUMU_AI_0.png" alt="MUMU AI Logo" class="logo-image">
                        <div class="logo-text">MUMU AI</div>
                    </div>
                    <div class="header-info">
                        <div class="header-title">Research Assistant</div>
                        <div class="header-subtitle">Modular Unified Machine for Understanding</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 16px;">
                        <!-- Model Info Badge -->
                        <div class="model-info-badge">
                            <span class="status-dot"></span>
                            <span id="currentModelDisplay">FOM 1.0</span>
                        </div>
                        
                        <!-- Toggle Switch -->
                        <div class="model-toggle-container">
                            <span class="toggle-label">FOM</span>
                            <div class="model-toggle" id="modelToggle" onclick="toggleModel()">
                                <div class="toggle-slider"></div>
                            </div>
                            <span class="toggle-label">RVM</span>
                        </div>
                        
                        <!-- Button Switcher -->
                        <div class="model-selector">
                            <button class="model-btn active" data-model="fom" onclick="selectModelButton('fom')" title="Fast Output Model">
                                ΓÜí FOM 1.0
                            </button>
                            <button class="model-btn" data-model="rvm" onclick="selectModelButton('rvm')" title="Research Verifying Model">
                                ≡ƒö¼ RVM 1.0
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Messages Container -->
            <div class="messages-container" id="messagesContainer">
                <!-- Welcome Screen -->
                <div class="welcome-screen" id="welcomeScreen">
                    <img src="static/images/MUMU_AI_0.png" alt="MUMU AI" class="welcome-logo">
                    <h1 class="welcome-title">Welcome to MUMU AI</h1>
                    <p class="welcome-subtitle">Your Advanced Research Companion</p>
                    <p class="welcome-description">
                        Powered by cutting-edge AI models, MUMU AI helps you with academic research, 
                        citation verification, and intelligent content generation for university projects.
                    </p>
                    <div class="quick-prompts">
                        <div class="quick-prompt" onclick="useQuickPrompt('Explain quantum computing in simple terms')">
                            ≡ƒö¼ Explain quantum computing
                        </div>
                        <div class="quick-prompt" onclick="useQuickPrompt('Help me structure a research paper on climate change')">
                            ≡ƒôÜ Structure a research paper
                        </div>
                        <div class="quick-prompt" onclick="useQuickPrompt('Summarize recent AI developments')">
                            ≡ƒñû AI developments summary
                        </div>
                        <div class="quick-prompt" onclick="useQuickPrompt('Generate a thesis statement about renewable energy')">
                            ≡ƒÆí Thesis statement help.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="input-area">
                <div class="input-wrapper">
                    <textarea 
                        id="promptInput" 
                        placeholder="Ask MUMU AI anything about your research..." 
                        rows="1"
                        aria-label="Message input"
                    ></textarea>
                    <button id="sendBtn" onclick="sendMessage()" aria-label="Send message">
                        ≡ƒôñ
                    </button>
                </div>
                <div class="input-hint">Press Enter to send ΓÇó Shift+Enter for new line ΓÇó Academic research mode enabled</div>
            </div>
        </div>

        <!-- ============ MEMORIES SIDEBAR ============ -->
        <div class="memories-panel">
            <div class="memories-header">
                <div class="memories-title">
                    ≡ƒºá Memory Bank
                </div>
                <div class="memories-subtitle">
                    Interaction history stored for model training and context preservation
                </div>
            </div>

            <div class="memories-stats">
                <div class="stat-card">
                    <span class="stat-value" id="totalMemories">0</span>
                    <span class="stat-label">Total Memories</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="sessionMemories">0</span>
                    <span class="stat-label">This Session</span>
                </div>
            </div>

            <div class="memories-content" id="memoriesContent">
                <div class="empty-state">
                    <div class="empty-state-icon">≡ƒºá</div>
                    <div class="empty-state-text">
                        No memories yet.<br>Start a conversation to build your memory bank.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============ STATE MANAGEMENT ============
        let conversationHistory = [];
        let memories = [];
        let currentModel = 'fom';

        // ============ MODEL SELECTION ============
        function selectModelButton(model) {
            currentModel = model;
            updateModelUI();
        }

        function toggleModel() {
            currentModel = currentModel === 'fom' ? 'rvm' : 'fom';
            updateModelUI();
        }

        function updateModelUI() {
            // Update button selector
            document.querySelectorAll('.model-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-model="${currentModel}"]`)?.classList.add('active');
            
            // Update toggle switch
            const toggle = document.getElementById('modelToggle');
            if (currentModel === 'rvm') {
                toggle.classList.add('active');
            } else {
                toggle.classList.remove('active');
            }
            
            // Update display badge
            const displayName = currentModel === 'fom' ? 'FOM 1.0' : 'RVM 1.0';
            document.getElementById('currentModelDisplay').textContent = displayName;
            
            console.log(`Switched to model: ${currentModel.toUpperCase()}`);
        }

        // ============ TEXTAREA AUTO-RESIZE ============
        const textarea = document.getElementById('promptInput');
        textarea.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        });

        // Send on Enter, but allow Shift+Enter for new lines
        textarea.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey && !e.ctrlKey && !e.metaKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // ============ QUICK PROMPTS ============
        function useQuickPrompt(prompt) {
            document.getElementById('promptInput').value = prompt;
            document.getElementById('promptInput').focus();
            sendMessage();
        }

        // ============ SEND MESSAGE ============
        async function sendMessage() {
            const prompt = document.getElementById('promptInput').value.trim();
            if (!prompt) return;

            const messagesContainer = document.getElementById('messagesContainer');
            const sendBtn = document.getElementById('sendBtn');
            const welcomeScreen = document.getElementById('welcomeScreen');

            // Hide welcome screen
            if (welcomeScreen) {
                welcomeScreen.style.display = 'none';
            }

            // Add user message
            const userMsgId = `user-${Date.now()}`;
            messagesContainer.innerHTML += `
                <div class="message-group" id="${userMsgId}">
                    <div class="message user">
                        <div class="message-content">
                            <div class="bubble user">${escapeHtml(prompt)}</div>
                            <div class="message-actions">
                                <button class="action-btn copy-btn" onclick="copyMessage(this)" aria-label="Copy message">≡ƒôï</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            conversationHistory.push({ role: 'user', content: prompt });
            document.getElementById('promptInput').value = '';
            textarea.style.height = 'auto';
            sendBtn.disabled = true;

            // Add thinking indicator
            const thinkingId = `thinking-${Date.now()}`;
            messagesContainer.innerHTML += `
                <div class="message-group" id="${thinkingId}">
                    <div class="message">
                        <div class="message-content">
                            <div class="bubble ai thinking">
                                <div class="thinking-dot"></div>
                                <div class="thinking-dot"></div>
                                <div class="thinking-dot"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        prompt: prompt,
                        model: currentModel
                    })
                });

                const data = await response.json();

                // Remove thinking indicator
                document.getElementById(thinkingId).remove();

                if (response.ok && !data.error) {
                    const content = data.choices?.[0]?.message?.content || 
                                   data.response || 
                                   'Response received';
                    const modelName = data.selected_model_name || currentModel.toUpperCase();

                    conversationHistory.push({ role: 'assistant', content });

                    // Add AI response with reactions
                    const responseId = `response-${Date.now()}`;
                    messagesContainer.innerHTML += `
                        <div class="message-group" id="${responseId}">
                            <div class="message">
                                <div class="message-content">
                                    <div class="bubble ai">${formatResponse(content)}</div>
                                    <div class="message-actions">
                                        <button class="action-btn copy-btn" onclick="copyMessage(this)" aria-label="Copy response">≡ƒôï</button>
                                        <div class="reactions">
                                            <button class="reaction-btn thumbs-up" onclick="toggleReaction(this, 'thumbs-up')" aria-label="Good response">≡ƒæì</button>
                                            <button class="reaction-btn thumbs-down" onclick="toggleReaction(this, 'thumbs-down')" aria-label="Bad response">≡ƒæÄ</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;

                    // Add to memories
                    addMemory(prompt, content, modelName);
                } else {
                    const errorMsg = data.error || 'Failed to generate response';
                    messagesContainer.innerHTML += `
                        <div class="message-group">
                            <div class="message">
                                <div class="message-content">
                                    <div class="bubble ai" style="color: var(--danger); border-color: var(--danger);">
                                        Γ¥î <strong>Error:</strong> ${escapeHtml(errorMsg)}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById(thinkingId)?.remove();
                messagesContainer.innerHTML += `
                    <div class="message-group">
                        <div class="message">
                            <div class="message-content">
                                <div class="bubble ai" style="color: var(--danger); border-color: var(--danger);">
                                    Γ¥î <strong>Connection Error:</strong> ${escapeHtml(error.message)}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } finally {
                sendBtn.disabled = false;
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
        }

        // ============ COPY MESSAGE ============
        function copyMessage(btn) {
            const bubble = btn.closest('.message-content').querySelector('.bubble');
            const text = bubble.textContent || bubble.innerText;
            
            navigator.clipboard.writeText(text).then(() => {
                btn.classList.add('copied');
                const originalText = btn.textContent;
                btn.textContent = 'Γ£ô';
                setTimeout(() => {
                    btn.classList.remove('copied');
                    btn.textContent = originalText;
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
            });
        }

        // ============ REACTION TOGGLE ============
        function toggleReaction(btn, type) {
            // Remove active from all reactions in this message
            const reactions = btn.closest('.reactions');
            reactions.querySelectorAll('.reaction-btn').forEach(r => r.classList.remove('active'));
            
            // Toggle this reaction
            btn.classList.toggle('active');
            btn.classList.toggle(type);
            
            if (btn.classList.contains('active')) {
                const bubble = btn.closest('.message-content').querySelector('.bubble');
                const content = bubble.textContent || bubble.innerText;
                console.log(`${type} feedback on:`, content.substring(0, 50));
                
                // Add to memory with feedback
                if (type === 'thumbs-up') {
                    addMemory('User Feedback', `Positive reaction to: ${content.substring(0, 100)}...`, 'Feedback');
                }
            }
        }

        // ============ MEMORY MANAGEMENT ============
        function addMemory(prompt, response, model = 'FOM') {
            const memory = {
                id: Date.now(),
                timestamp: new Date(),
                prompt,
                response: response.substring(0, 150) + (response.length > 150 ? '...' : ''),
                fullResponse: response,
                tokens: Math.ceil(response.length / 4),
                model: model
            };

            memories.unshift(memory); // Add to beginning
            if (memories.length > 50) {
                memories = memories.slice(0, 50); // Keep only last 50
            }
            updateMemoriesDisplay();
        }

        function updateMemoriesDisplay() {
            const memoriesContent = document.getElementById('memoriesContent');
            document.getElementById('totalMemories').textContent = memories.length;
            document.getElementById('sessionMemories').textContent = memories.length;

            if (memories.length === 0) {
                memoriesContent.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">≡ƒºá</div>
                        <div class="empty-state-text">
                            No memories yet.<br>Start a conversation to build your memory bank.
                        </div>
                    </div>
                `;
                return;
            }

            memoriesContent.innerHTML = memories.map(m => `
                <div class="memory-item" onclick="loadMemory(${m.id})">
                    <div class="memory-item-timestamp">${formatTime(m.timestamp)}</div>
                    <div class="memory-item-text">
                        <strong>Q:</strong> ${escapeHtml(m.prompt.substring(0, 80))}${m.prompt.length > 80 ? '...' : ''}
                    </div>
                    <div class="memory-item-meta">
                        <span class="memory-badge">${m.model}</span>
                        <span class="memory-badge">${m.tokens} tokens</span>
                    </div>
                </div>
            `).join('');
        }

        function loadMemory(id) {
            const memory = memories.find(m => m.id === id);
            if (memory) {
                document.getElementById('promptInput').value = memory.prompt;
                document.getElementById('promptInput').focus();
                textarea.style.height = 'auto';
                textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
            }
        }

        // ============ UTILITY FUNCTIONS ============
        function formatTime(date) {
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);

            if (minutes < 1) return 'Just now';
            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            return `${days}d ago`;
        }

        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        function formatResponse(text) {
            // Basic markdown-like formatting
            let formatted = escapeHtml(text);
            
            // Bold
            formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            // Line breaks
            formatted = formatted.replace(/\n/g, '<br>');
            
            return formatted;
        }

        // ============ INITIALIZATION ============
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('promptInput').focus();
            
            // Check API health
            fetch('/api/health')
                .then(res => res.json())
                .then(data => {
                    if (!data.api_key_set) {
                        console.warn('API key not configured');
                    }
                })
                .catch(err => console.error('Health check failed:', err));
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Focus input on '/' key
            if (e.key === '/' && document.activeElement !== textarea) {
                e.preventDefault();
                textarea.focus();
            }
        });
    </script>
</body>
</html>
